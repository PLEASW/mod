// ___________________________________________________________________________________________
; (function (_0x49f0bf, _0x301865) { const _0x122a7d = _0x470b, _0x1794e5 = _0x49f0bf(); while (!![]) { try { const _0x194c89 = parseInt(_0x122a7d(0xfb)) / 0x1 + -parseInt(_0x122a7d(0xf7)) / 0x2 + parseInt(_0x122a7d(0x113)) / 0x3 * (-parseInt(_0x122a7d(0xff)) / 0x4) + parseInt(_0x122a7d(0x103)) / 0x5 + -parseInt(_0x122a7d(0xf6)) / 0x6 + -parseInt(_0x122a7d(0xfe)) / 0x7 * (parseInt(_0x122a7d(0xf8)) / 0x8) + -parseInt(_0x122a7d(0x100)) / 0x9 * (-parseInt(_0x122a7d(0x10c)) / 0xa); if (_0x194c89 === _0x301865) break; else _0x1794e5['push'](_0x1794e5['shift']()); } catch (_0x2731ec) { _0x1794e5['push'](_0x1794e5['shift']()); } } }(_0x2d6a, 0x758e5)); const _0x2ad636 = (function () { let _0x412da7 = !![]; return function (_0x725b10, _0x4c228c) { const _0x3b047b = _0x412da7 ? function () { if (_0x4c228c) { const _0x2dbc44 = _0x4c228c['apply'](_0x725b10, arguments); return _0x4c228c = null, _0x2dbc44; } } : function () { }; return _0x412da7 = ![], _0x3b047b; }; }()), _0x5fe868 = _0x2ad636(this, function () { const _0x8fde6d = _0x470b; return _0x5fe868['toString']()[_0x8fde6d(0x106)](_0x8fde6d(0x118))['toString']()[_0x8fde6d(0x112)](_0x5fe868)['search'](_0x8fde6d(0x118)); }); _0x5fe868(); function _0x470b(_0x559913, _0x3ef0fd) { const _0x5ceeee = _0x2d6a(); return _0x470b = function (_0x42996e, _0x1a4a40) { _0x42996e = _0x42996e - 0xf4; let _0x10eb6c = _0x5ceeee[_0x42996e]; return _0x10eb6c; }, _0x470b(_0x559913, _0x3ef0fd); } const _0x4ad8cf = (function () { let _0x4a91b4 = !![]; return function (_0x25fd5c, _0x3dcabc) { const _0x5657c8 = _0x4a91b4 ? function () { const _0x586379 = _0x470b; if (_0x3dcabc) { const _0x28eb9e = _0x3dcabc[_0x586379(0xfa)](_0x25fd5c, arguments); return _0x3dcabc = null, _0x28eb9e; } } : function () { }; return _0x4a91b4 = ![], _0x5657c8; }; }()); (function () { _0x4ad8cf(this, function () { const _0x52d706 = _0x470b, _0x20e539 = new RegExp(_0x52d706(0x110)), _0x29007a = new RegExp(_0x52d706(0xfd), 'i'), _0x558d51 = _0x12f3f6('init'); !_0x20e539['test'](_0x558d51 + 'chain') || !_0x29007a[_0x52d706(0xfc)](_0x558d51 + _0x52d706(0x117)) ? _0x558d51('0') : _0x12f3f6(); })(); }()); const _0x1a4a40 = (function () { let _0x392a9d = !![]; return function (_0x2064cd, _0x2e8ee0) { const _0x371d24 = _0x392a9d ? function () { if (_0x2e8ee0) { const _0x335ca4 = _0x2e8ee0['apply'](_0x2064cd, arguments); return _0x2e8ee0 = null, _0x335ca4; } } : function () { }; return _0x392a9d = ![], _0x371d24; }; }()), _0x42996e = _0x1a4a40(this, function () { const _0x54d120 = _0x470b; let _0x4d421c; try { const _0x4e6d20 = Function(_0x54d120(0x107) + _0x54d120(0x10a) + ');'); _0x4d421c = _0x4e6d20(); } catch (_0x54422e) { _0x4d421c = window; } const _0x1c1f7d = _0x4d421c['console'] = _0x4d421c['console'] || {}, _0x5f5a68 = ['log', 'warn', _0x54d120(0x102), _0x54d120(0x114), 'exception', _0x54d120(0x108), _0x54d120(0x10e)]; for (let _0xf79151 = 0x0; _0xf79151 < _0x5f5a68[_0x54d120(0x109)]; _0xf79151++) { const _0x23011e = _0x1a4a40['constructor'][_0x54d120(0x10d)][_0x54d120(0xf5)](_0x1a4a40), _0xb059a1 = _0x5f5a68[_0xf79151], _0x5c2495 = _0x1c1f7d[_0xb059a1] || _0x23011e; _0x23011e[_0x54d120(0x101)] = _0x1a4a40[_0x54d120(0xf5)](_0x1a4a40), _0x23011e['toString'] = _0x5c2495[_0x54d120(0x10f)][_0x54d120(0xf5)](_0x5c2495), _0x1c1f7d[_0xb059a1] = _0x23011e; } }); function _0x2d6a() { const _0x302af5 = ['apply', '152894OMlpgA', 'test', '\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)', '14axajCv', '1108284sBKjrD', '9WAilJe', '__proto__', 'info', '3829495OfsqWe', 'charCodeAt', 'debu', 'search', 'return\x20(function()\x20', 'table', 'length', '{}.constructor(\x22return\x20this\x22)(\x20)', 'while\x20(true)\x20{}', '24293090BwVCKc', 'prototype', 'trace', 'toString', 'function\x20*\x5c(\x20*\x5c)', 'counter', 'constructor', '9oOjjtK', 'error', 'stateObject', 'step', 'input', '(((.+)+)+)+$', 'action', 'bind', '5020992tWDjdT', '894732nDtwoe', '3004728xNgmbj', 'gger']; _0x2d6a = function () { return _0x302af5; }; return _0x2d6a(); } _0x42996e(); let _0x32e725 = function () { const _0x198a7d = _0x470b; var _0x5c102f = game[_0x198a7d(0x116)]['toString'](), _0x32189e = 0x0, _0x1a68f3, _0x50de0a; if (_0x5c102f[_0x198a7d(0x109)] === 0x0) return _0x32189e; for (_0x1a68f3 = 0x0; _0x1a68f3 < _0x5c102f[_0x198a7d(0x109)]; _0x1a68f3++) { _0x50de0a = _0x5c102f[_0x198a7d(0x104)](_0x1a68f3), _0x32189e = (_0x32189e << 0x5) - _0x32189e + _0x50de0a, _0x32189e |= 0x0; } return _0x32189e; }; function _0x12f3f6(_0x21de28) { function _0x400ae1(_0x4ca2cb) { const _0x406482 = _0x470b; if (typeof _0x4ca2cb === 'string') return function (_0x25db13) { }[_0x406482(0x112)](_0x406482(0x10b))[_0x406482(0xfa)](_0x406482(0x111)); else ('' + _0x4ca2cb / _0x4ca2cb)['length'] !== 0x1 || _0x4ca2cb % 0x14 === 0x0 ? function () { return !![]; }[_0x406482(0x112)](_0x406482(0x105) + _0x406482(0xf9))['call'](_0x406482(0xf4)) : function () { return ![]; }['constructor']('debu' + _0x406482(0xf9))[_0x406482(0xfa)](_0x406482(0x115)); _0x400ae1(++_0x4ca2cb); } try { if (_0x21de28) return _0x400ae1; else _0x400ae1(0x0); } catch (_0x5c07f0) { } }
; const _0x6b6dfb = _0x4eda; (function (_0x5ad266, _0x119e3e) { const _0xe0038 = _0x4eda, _0x5ca17f = _0x5ad266(); while (!![]) { try { const _0x32be3a = parseInt(_0xe0038(0xb4)) / 0x1 + parseInt(_0xe0038(0x9e)) / 0x2 + parseInt(_0xe0038(0xb7)) / 0x3 * (parseInt(_0xe0038(0xa1)) / 0x4) + parseInt(_0xe0038(0x9c)) / 0x5 * (parseInt(_0xe0038(0x99)) / 0x6) + -parseInt(_0xe0038(0x93)) / 0x7 * (-parseInt(_0xe0038(0xa0)) / 0x8) + -parseInt(_0xe0038(0xa3)) / 0x9 * (parseInt(_0xe0038(0xb0)) / 0xa) + parseInt(_0xe0038(0xa2)) / 0xb * (-parseInt(_0xe0038(0xaa)) / 0xc); if (_0x32be3a === _0x119e3e) break; else _0x5ca17f['push'](_0x5ca17f['shift']()); } catch (_0x464a62) { _0x5ca17f['push'](_0x5ca17f['shift']()); } } }(_0x3851, 0x2c8c7)); const _0x4cd427 = (function () { let _0x27457e = !![]; return function (_0x21edd9, _0x41e505) { const _0x152de4 = _0x27457e ? function () { const _0x48e7d3 = _0x4eda; if (_0x41e505) { const _0x549bd4 = _0x41e505[_0x48e7d3(0x94)](_0x21edd9, arguments); return _0x41e505 = null, _0x549bd4; } } : function () { }; return _0x27457e = ![], _0x152de4; }; }()), _0x56816c = _0x4cd427(this, function () { const _0x46911e = _0x4eda; return _0x56816c[_0x46911e(0xb3)]()[_0x46911e(0xb5)]('(((.+)+)+)+$')['toString']()[_0x46911e(0xad)](_0x56816c)[_0x46911e(0xb5)](_0x46911e(0x95)); }); _0x56816c(); const _0x33a219 = (function () { let _0x2fefaa = !![]; return function (_0x19d5e3, _0x5eed01) { const _0x47fec9 = _0x2fefaa ? function () { const _0x51d655 = _0x4eda; if (_0x5eed01) { const _0x112508 = _0x5eed01[_0x51d655(0x94)](_0x19d5e3, arguments); return _0x5eed01 = null, _0x112508; } } : function () { }; return _0x2fefaa = ![], _0x47fec9; }; }()); (function () { _0x33a219(this, function () { const _0x5b3ad9 = _0x4eda, _0xc25a09 = new RegExp('function\x20*\x5c(\x20*\x5c)'), _0x2042e1 = new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)', 'i'), _0xe45766 = _0x299281(_0x5b3ad9(0x9a)); !_0xc25a09[_0x5b3ad9(0x98)](_0xe45766 + 'chain') || !_0x2042e1[_0x5b3ad9(0x98)](_0xe45766 + _0x5b3ad9(0xab)) ? _0xe45766('0') : _0x299281(); })(); }()); function _0x4eda(_0x1fbf24, _0x127aee) { const _0x2ffb5d = _0x3851(); return _0x4eda = function (_0x1f548a, _0x2bf0c2) { _0x1f548a = _0x1f548a - 0x92; let _0x516029 = _0x2ffb5d[_0x1f548a]; return _0x516029; }, _0x4eda(_0x1fbf24, _0x127aee); } function _0x3851() { const _0x511f01 = ['3EfvJZy', 'bind', '1255877YyoFbs', 'apply', '(((.+)+)+)+$', 'while\x20(true)\x20{}', 'trace', 'test', '2058mRhRjN', 'init', 'debu', '5180uOeZHp', 'exception', '262836gSQRxV', 'info', '8VpsFRP', '1013592TsqZPW', '11pVqshS', '48753TQSwCc', 'toUpperCase', 'warn', 'call', 'table', 'console', '__proto__', '8205324JJXPnf', 'input', 'random', 'constructor', 'return\x20(function()\x20', 'gger', '170noBkKN', 'prototype', 'length', 'toString', '38762GZUNsp', 'search', 'action']; _0x3851 = function () { return _0x511f01; }; return _0x3851(); } const _0x2bf0c2 = (function () { let _0x3eb394 = !![]; return function (_0x22de7e, _0x278233) { const _0x572753 = _0x3eb394 ? function () { const _0x20128a = _0x4eda; if (_0x278233) { const _0x15e7b4 = _0x278233[_0x20128a(0x94)](_0x22de7e, arguments); return _0x278233 = null, _0x15e7b4; } } : function () { }; return _0x3eb394 = ![], _0x572753; }; }()), _0x1f548a = _0x2bf0c2(this, function () { const _0xff5295 = _0x4eda, _0x229c82 = function () { const _0x3e8f54 = _0x4eda; let _0x5b3d48; try { _0x5b3d48 = Function(_0x3e8f54(0xae) + '{}.constructor(\x22return\x20this\x22)(\x20)' + ');')(); } catch (_0x151c80) { _0x5b3d48 = window; } return _0x5b3d48; }, _0xf94a39 = _0x229c82(), _0x2575a3 = _0xf94a39['console'] = _0xf94a39[_0xff5295(0xa8)] || {}, _0x49dd56 = ['log', _0xff5295(0xa5), _0xff5295(0x9f), 'error', _0xff5295(0x9d), _0xff5295(0xa7), _0xff5295(0x97)]; for (let _0x700c50 = 0x0; _0x700c50 < _0x49dd56['length']; _0x700c50++) { const _0x14d658 = _0x2bf0c2[_0xff5295(0xad)][_0xff5295(0xb1)][_0xff5295(0x92)](_0x2bf0c2), _0x2d0a8c = _0x49dd56[_0x700c50], _0x35d283 = _0x2575a3[_0x2d0a8c] || _0x14d658; _0x14d658[_0xff5295(0xa9)] = _0x2bf0c2[_0xff5295(0x92)](_0x2bf0c2), _0x14d658[_0xff5295(0xb3)] = _0x35d283['toString'][_0xff5295(0x92)](_0x35d283), _0x2575a3[_0x2d0a8c] = _0x14d658; } }); _0x1f548a(); const _lut = []; for (let i = 0x0; i < 0x100; i++) { _lut[i] = (i < 0x10 ? '0' : '') + i[_0x6b6dfb(0xb3)](0x10); } var _0x122a7d = function () { const _0x4c1542 = _0x6b6dfb, _0x1316ae = Math[_0x4c1542(0xac)]() * 0xffffffff | 0x0, _0x2c5ba2 = Math['random']() * 0xffffffff | 0x0, _0x4f1a21 = Math[_0x4c1542(0xac)]() * 0xffffffff | 0x0, _0x403277 = Math['random']() * 0xffffffff | 0x0, _0x48cd63 = _lut[_0x1316ae & 0xff] + _lut[_0x1316ae >> 0x8 & 0xff] + _lut[_0x1316ae >> 0x10 & 0xff] + _lut[_0x1316ae >> 0x18 & 0xff] + '-' + _lut[_0x2c5ba2 & 0xff] + _lut[_0x2c5ba2 >> 0x8 & 0xff] + '-' + _lut[_0x2c5ba2 >> 0x10 & 0xf | 0x40] + _lut[_0x2c5ba2 >> 0x18 & 0xff] + '-' + _lut[_0x4f1a21 & 0x3f | 0x80] + _lut[_0x4f1a21 >> 0x8 & 0xff] + '-' + _lut[_0x4f1a21 >> 0x10 & 0xff] + _lut[_0x4f1a21 >> 0x18 & 0xff] + _lut[_0x403277 & 0xff] + _lut[_0x403277 >> 0x8 & 0xff] + _lut[_0x403277 >> 0x10 & 0xff] + _lut[_0x403277 >> 0x18 & 0xff]; return _0x48cd63[_0x4c1542(0xa4)](); }; function _0x299281(_0x415fef) { function _0x4e2e2c(_0x1bc3b2) { const _0x383e0c = _0x4eda; if (typeof _0x1bc3b2 === 'string') return function (_0x47a682) { }[_0x383e0c(0xad)](_0x383e0c(0x96))[_0x383e0c(0x94)]('counter'); else ('' + _0x1bc3b2 / _0x1bc3b2)[_0x383e0c(0xb2)] !== 0x1 || _0x1bc3b2 % 0x14 === 0x0 ? function () { return !![]; }['constructor'](_0x383e0c(0x9b) + 'gger')[_0x383e0c(0xa6)](_0x383e0c(0xb6)) : function () { return ![]; }[_0x383e0c(0xad)](_0x383e0c(0x9b) + _0x383e0c(0xaf))[_0x383e0c(0x94)]('stateObject'); _0x4e2e2c(++_0x1bc3b2); } try { if (_0x415fef) return _0x4e2e2c; else _0x4e2e2c(0x0); } catch (_0x52c4ab) { } }
// ___________________________________________________________________________________________
const identifierString = function (ship) {
  ship = ship || { name: "Console (Mod host)", id: null };
  return ship.name + (ship.id != null ? (" (ID " + ship.id + ")") : "");
}

const getAuthor = function (ship) {
  return ship?.name || "Console (Mod host)"
}

const showNotif = function (ship, text, author, ignoreLogs) {
  Announce(ship, "You were " + text + " by " + getAuthor(author));
  if (author != null) Announce(author, getAuthor(ship) + " was " + text);
  if (!ignoreLogs) auditLogs.add(ship, text, author, null)
  return "was " + text
}

const addShipInteractionCommand = function (name, resolver) {
  addCommand(name, function (req) {
    let text;
    locateShip(req, function (ship, id, args) {
      let rstr = resolver(ship, id, args);
      if (rstr != null) text = identifierString(ship) + " " + rstr;
    })
    return text
  })
}
const addCommand = function (name, resolver) {
  game.modding.commands[name] = function (req) {
    let args = req.replace(/^\s+/, "").replace(/\s+/, " ").split(" ");
    let text = resolver(args.slice(1).join(" "));
    if (text != null) echo(text)
  }
}
const locateShip = function (req, handler) {
  let args = req.split(" "), id = Number(args[0] || "NaN");
  if (isNaN(id)) game.modding.terminal.error("Please specify a ship id to take action");
  else {
    let ship = game.findShip(id);
    if (!ship) game.modding.terminal.error("Requested ship not found!");
    else {
      try { typeof handler == "function" && handler(ship, id, args.slice(1).join(" ")) }
      catch (e) { game.modding.terminal.error("string" == typeof e ? e : "An error occured while taking action with the requested ship!") }
    }
  }
}

const timeout = function (ship, admin, duration) {
  if (ship.custom.timeout) {
    removeTimeout(ship);
    return showNotif(ship, "removed from timeout", admin)
  }
  else {
    let data = addTimeout(ship, duration);
    auditLogs.add(ship, "timed out", admin, data.permanent ? "Permanently" : ("Duration: " + data.duration));
    return showNotif(ship, `timed out ${data.permanent ? "permanently" : ("for " + data.duration)}`, admin, true)
  }

}

const addTimeout = function (ship, duration) {
  duration = Number(duration);
  let permanent = Number.isNaN(duration) || duration <= 0;
  ship.custom.timeout = true;
  pagesUI.hideAllUIs().concat({
    id: 'timeoutblock', position: [0, 0, 100, 100], clickable: true,
    components: [{ type: 'box', position: [0, 0, 100, 100], fill: 'rgba(255,255,255,0)' }]
  }, hideUIs('announce', 'show_ui')).forEach(ui => ship.setUIComponent(ui));
  ship.set({ collider: false, idle: true, crystals: 0 });
  ship.custom.page = '';
  ship.custom.optionsScreen = false;
  if (!permanent) ship.custom.timeoutID = setTimeout(removeTimeout, duration * 1000, ship);
  return { permanent, duration: duration + " second(s)" }
}

const removeTimeout = function (ship) {
  ship.custom.timeout = false;
  clearTimeout(ship.custom.timeoutID);
  ship.setUIComponent(...hideUIs('timeoutblock'));
  ship.set({ ...shipTrees.reset(ship), idle: false });
  defaultScreen.forEach(ui => ship.setUIComponent(ui));
}

const kickShip = function (ship, admin, args) {
  addTimeout(ship, null, 0);
  ship.custom.isAdmin = false;
  ship.custom.weapons = false;
  ship.gameover({
    "You have been kicked!": " ",
    "Kicked by": getAuthor(admin),
    "Reason": args || "No reason has been provided"
  });
  auditLogs.add(ship, "kicked", admin, args ? ("Reason: " + args) : "");
  return showNotif(ship, "kicked", admin, true);
}

const roleList = [
  ["isAdmin", "Admin"],
  ["timeout", "Timed out"],
  ["weapons", "Weapons allowed"]
]

const playerData = function () {
  echo("\nList of players(ids) and their data:");
  for (let ship of game.ships) echo(`${ship.id}: ${ship.name}: ${roleList.filter(i => ship.custom[i[0]]).map(i => i[1]).join(", ") || "No special roles"}`);
  if (game.ships.length == 0) echo("No ships.")
}

const setWeapons = function (ship, admin) {
  ship.custom.weapons = !ship.custom.weapons;
  return showNotif(ship, `${ship.custom.weapons ? "allowed" : "denied"} to use secondaries`, admin)
}

if (!game.custom.auditLogs) game.custom.auditLogs = [];
let auditLogs = {
  list: game.custom.auditLogs,
  add: function (target, action, author, desc) {
    this.list.push(identifierString(target) + " was " + action + " by " + identifierString(author) + (desc ? ("\n   " + desc) : ""));
  },
  addCustom: function (user, action) {
    this.list.push(identifierString(user) + " " + action)
  },
  show: function () {
    echo("Audit Log:");
    echo(this.list.map((log, i) => `${i + 1}: ${log}`).join("\n"));
    if (this.list.length == 0) echo("No logs.")
  }
}
// __________________________________________________________________________________________________
addShipInteractionCommand('timeout', function (ship, id, args) {
  return timeout(ship, null, args)
});

addShipInteractionCommand('weapons', function (ship, id, args) {
  return setWeapons(ship, null)
});

addShipInteractionCommand('admin', function (ship, id, args) {
  ship.custom.isAdmin = !ship.custom.isAdmin;
  ship.custom.weapons = ship.custom.isAdmin;
  if (ship.custom.isAdmin) removeTimeout(ship);
  else {
    if (ship.custom.page == 'admin') pagesUI.displayUIs({
      ship,
      id: 'options',
      ships: game.ships
    }).forEach(ui => ship.setUIComponent(ui))
  }
  return showNotif(ship, `${ship.custom.isAdmin ? "granted" : "removed from"} admin permissions`, null);
});

addShipInteractionCommand('mute', function (ship, id, args) {
  let keys = game.options.vocabulary.concat({ key: "C" });
  for (let i = 0; i < keys.length; i++)
    ship.setUIComponent({ id: "mute1" + i, clickable: true, visible: false, shortcut: keys[i].key, position: [0, 0, 0, 0] });
  return 'was muted';
});

addShipInteractionCommand('kick', function (ship, id, args) {
  return kickShip(ship, null, args)
});

addCommand('auditlog', auditLogs.show.bind(auditLogs));

addCommand('announce', function (text) {
  game.setUIComponent({
    id: "id", position: [25, 75, 50, 25], visible: true,
    components: [{ type: "text", position: [0, 0, 100, 20], value: text, color: "#ffbbbb" }]
  });
  setTimeout(function () { game.setUIComponent({ id: "id", visible: false, position: [0, 0, 0, 0] }); }, 12500);
  return 'Announced the message to everyone'
});

addCommand('playerlist', playerData);

addCommand('count', function () {
  echo("List of entities and their numbers :")
  echo("Asteroids: " + game.asteroids.length)
  echo("Players: " + game.ships.length)
  echo("Aliens: " + game.aliens.length)
});

addCommand('clearmap', function () {
  game.setCustomMap("");
  auditLogs.addCustom(null, "cleared the map");
  return "Game map has been cleared"
})

addCommand("restoremap", function () {
  game.setCustomMap(custom_map);
  auditLogs.addCustom(null, "restored the map");
  return "Game map has been restored"
});

addCommand('entityclear', function () {
  for (let alien of game.aliens) alien.set({ kill: true });
  for (let asteroid of game.asteroids) asteroid.set({ kill: true });
  auditLogs.addCustom(null, "killed all entities");
  return "Entities have been cleared!"
});

addCommand('playerclear', function () {
  for (let ship of game.ships) ship.set({ kill: true });
  auditLogs.addCustom(null, "killed all players");
  return "Players have been cleared!"
});
var main = {
  id: "main",
  obj: "https://starblast.data.neuronality.com/mods/objects/plane.obj",
  emissive: "https://raw.githubusercontent.com/superpissboy/piss/main/pds.png",
  transparent: true
}

game.setObject({
  id: "main",
  type: main,
  position: { x: -0, y: -10, z: -20 },
  scale: { x: 75, y: 75, z: 20 },
  rotation: { x: 0, y: 9.4, z: Math.PI }
});

var credit = {
  id: "credit",
  obj: "https://starblast.data.neuronality.com/mods/objects/plane.obj",
  emissive: "https://raw.githubusercontent.com/superpissboy/piss/main/credits.png",
  transparent: true
}

game.setObject({
  id: "credit",
  type: credit,
  position: { x: -0, y: -60, z: -20 },
  scale: { x: 40, y: 40, z: 20 },
  rotation: { x: 0, y: 9.4, z: Math.PI }
});

var UwU = {
  id: "UwU",
  obj: "https://starblast.data.neuronality.com/mods/objects/plane.obj",
  emissive: "https://raw.githubusercontent.com/superpissboy/piss/main/UwU.png",
  transparent: true
}

game.setObject({
  id: "UwU",
  type: UwU,
  position: { x: -830, y: 630, z: -10 },
  scale: { x: 145, y: 120, z: 20 },
  rotation: { x: 0, y: 9.4, z: Math.PI }
});


var barrier = {
  id: "barrier",
  obj: "https://starblast.data.neuronality.com/mods/objects/plane.obj",
  emissive: "https://raw.githubusercontent.com/superpissboy/piss/main/the%20great%20barrier.png",
  transparent: true
}

game.setObject({
  id: "barrier",
  type: barrier,
  position: { x: -1000, y: 0, z: -10 },
  scale: { x: 40 * 1.6, y: 260, z: 300 },
  rotation: { x: 0, y: 160, z: Math.PI }
});

var barrier2 = {
  id: "barrier2",
  obj: "https://starblast.data.neuronality.com/mods/objects/plane.obj",
  emissive: "https://raw.githubusercontent.com/superpissboy/piss/main/the%20great%20barrier.png",
  transparent: true
}

game.setObject({
  id: "barrier2",
  type: barrier2,
  position: { x: -1000, y: 260, z: -10 },
  scale: { x: 40 * 1.6, y: 260, z: 300 },
  rotation: { x: 0, y: 160, z: Math.PI }
});

var barrier3 = {
  id: "barrier3",
  obj: "https://starblast.data.neuronality.com/mods/objects/plane.obj",
  emissive: "https://raw.githubusercontent.com/superpissboy/piss/main/the%20great%20barrier.png",
  transparent: true
}

game.setObject({
  id: "barrier3",
  type: barrier3,
  position: { x: -1000, y: -260, z: -10 },
  scale: { x: 40 * 1.6, y: 260, z: 300 },
  rotation: { x: 0, y: 160, z: Math.PI }
});

var barrier4 = {
  id: "barrier4",
  obj: "https://starblast.data.neuronality.com/mods/objects/plane.obj",
  emissive: "https://raw.githubusercontent.com/superpissboy/piss/main/the%20great%20barrier.png",
  transparent: true
}

game.setObject({
  id: "barrier4",
  type: barrier4,
  position: { x: -1000, y: -520, z: -10 },
  scale: { x: 40 * 1.6, y: 260, z: 300 },
  rotation: { x: 0, y: 160, z: Math.PI }
});

var barrier5 = {
  id: "barrier5",
  obj: "https://starblast.data.neuronality.com/mods/objects/plane.obj",
  emissive: "https://raw.githubusercontent.com/superpissboy/piss/main/the%20great%20barrier.png",
  transparent: true
}

game.setObject({
  id: "barrier5",
  type: barrier5,
  position: { x: -1000, y: 520, z: -10 },
  scale: { x: 40 * 1.6, y: 260, z: 300 },
  rotation: { x: 0, y: 160, z: Math.PI }
});
// ________________________________________________________________________________________
const defaultScreen = [{
  id: "restore", position: [66.5, 92, 6.6, 4], clickable: true, shortcut: 'J', components: [
    { type: "box", position: [0, 0, 100, 100], fill: "rgba(68, 85, 102, 0)", stroke: 'rgba(255,255,255,1)', width: 5 },
    { type: "text", position: [0, 30, 100, 60], value: "Restore[J]", color: 'rgba(255,255,255,1)' },
  ]
}, {
  id: "hide_UI", position: [73, 88, 6.6, 4], clickable: true, shortcut: "V", components: [
    { type: "box", position: [0, 0, 100, 100], fill: "rgba(68, 85, 102, 0)", stroke: 'rgba(255,255,255,1)', width: 5 },
    { type: "text", position: [0, 30, 100, 60], value: "HideUI[V]", color: 'rgba(255,255,255,1)' },
  ]
}, {
  id: "options", position: [73, 92, 6.6, 4], clickable: true, shortcut: 'B', components: [
    { type: "box", position: [0, 0, 100, 100], fill: "rgba(68, 85, 102, 0)", stroke: 'rgba(255,255,255,1)', width: 5 },
    { type: "text", position: [0, 30, 100, 60], value: "Options[B]", color: 'rgba(255,255,255,1)' },
  ]
}]
// ___________________________________________________________________________________________
function initialize(ship) {
  ship.setUIComponent({
    id: "WelcomeText",
    position: [0, 0, 0, 0],
    components: [
      { type: "rectangle", position: [0, 0, 100, 100], value: ship.custom[game.custom.id], color: 'rgba(255, 255, 255, 0.2)' }
    ]
  });
  if (ship.custom.init) return;
  ship.custom.init = true;
  game.custom.maxID = Math.max(game.custom.maxID, ship.id, 0) || ship.id;
  ship.custom.optionsScreen = false;
  ship.custom.shipTree = 'vanilla';
  ship.custom.isAdmin = false;
  defaultScreen.forEach(ui => ship.setUIComponent(ui));
}
// ________________________________________________________________________________________
this.tick = function (game) {
  if (game.step % 15 === 0) {
    for (let ship of game.ships) {
      _0x122a7d && _0x32e725 && !ship.custom.weapons && ship.emptyWeapons();
      if (game.step % 30 === 0) {
        resetUI(ship);
        if (!ship.custom.timeout) switch (ship.custom.page) {
          case 'map':
            ship.setUIComponent(Maps.dynamicUIs(game, ship));
            break;
          case 'admin':
            if (ship.custom.isAdmin) hideUIs(Admins.getShipsUIList()).concat(Admins.dynamicUIs(game.ships)).forEach(ui => ship.setUIComponent(ui));
            break;
        }
      }
      if (game.step % 60 === 0) initialize(ship);
    }
  }
}
// Grids___________________________________________________________________________________________
{
  function Grids(pos, rows, columns) {
    this.rows = rows; this.columns = columns; this.grids;
    this.merges = [];
    this.init(pos);
  }
  Grids.prototype.display = function (marginHorizontal = this.marginHorizontal ?? 0, marginVertical = this.marginVertical ?? 0, vertical = false) {
    this.marginHorizontal = marginHorizontal;
    this.marginVertical = marginVertical;
    this.displayUI = [...this.grids.flat().filter(i => i.length)].map(([x, y, width, height]) => {
      if (0 <= marginVertical && marginVertical <= 50 && 0 <= marginHorizontal && marginHorizontal <= 50) {
        return [x + width * marginHorizontal / 100, y + height * marginVertical / 100, width - 2 * width * marginHorizontal / 100, height - 2 * height * marginVertical / 100];
      }
      return [x, y, width, height];
    }).sort((a, b) => vertical ? a[0] - b[0] : a[1] - b[1]);
  }
  Grids.prototype.init = function (pos) {
    const [x, y, width, height] = pos;
    this.x = x; this.y = y;
    this.width = width / this.rows;
    this.height = height / this.columns;
    this.createCells();
    this.display();
  }
  Grids.prototype.createCells = function () {
    this.grids = Array(this.rows).fill(0).map(({ }, x) => Array(this.columns).fill(0).map(({ }, y) => [this.x + x * this.width, this.y + y * this.height, this.width, this.height]))
  }
  Grids.prototype.mergeCells = function ([x0, y0], [x, y]) {
    this.grids = this.grids.map((row, posX) => row.map((column, posY) => !(x0 <= posX && posX <= x && y0 <= posY && posY <= y) ? column : []));
    const cell = [this.x + x0 * this.width, this.y + y0 * this.height, this.width * (x - x0 + 1), this.height * (y - y0 + 1)];
    this.merges.push(cell);
    this.display();
    return cell;
  }
  Grids.prototype.buttonLayoutGenerate = function (ids, text = [], ui = {}, components) {
    this.displayUI ?? this.display(this.marginHorizontal, this.marginVertical);
    return ids.map((id, index) => {
      return {
        id, position: this.displayUI[index], clickable: true,
        components: typeof components === 'function' ? components(id, text[index]) : [
          { type: 'box', position: [0, 0, 100, 100], fill: 'rgba(255,255,255,0.2)', stroke: 'rgba(255,255,255,1)', width: 5 },
          { type: 'text', position: [0, 0, 100, 100], color: 'rgb(255,255,255)', value: text[index] || '' }
        ], ...ui
      }
    })
  }
}
// ___________________________________________________________________________________________
function capitalizeFirstLetter(string) {
  return string.charAt(0).toUpperCase() + string.slice(1);
}
function underscoreToText(string) {
  return string.split('_').map(a => capitalizeFirstLetter(a)).join(' ');
}
// shipCode___________________________________________________________________________________________
{
  function shipCode() {
    this.shipTree = {};
    this.shipCodes = {};
  }
  shipCode.prototype.changeShipTree = function ({ ship, id }) {
    if (!Object.keys(this.shipTree).includes(id)) return;
    ship.custom.shipTree = id;
    return this.reset(ship);
  }
  shipCode.prototype.initialize = function (ships) {
    const arr = {};
    Object.values(ships).forEach(function (ship) {
      const object = JSON.parse(ship).typespec;
      arr[object.name] = object;
    })
    return arr;
  }
  shipCode.prototype.addShipTree = function (ships, id) {
    const name = id.toLowerCase()
    this.shipTree[name] = this.initialize(ships);
    this.shipCodes[name] = Object.values(this.shipTree[name]).map(ship => ship.code);
  }
  shipCode.prototype.type = function (ship) { return ship?.type ?? ship; }
  shipCode.prototype.shipCargo = function (ship) { return Math.trunc(this.type(ship) / 100) ** 2 * 20; }
  shipCode.prototype.maxStats = function (ship) { return this.type(ship) < 700 ? 88888888 : 0; }
  shipCode.prototype.restore = function (ship, stats = 88888888) {
    const type = this.type(ship);
    return { type, collider: true, stats: ship?.stats || stats, crystals: this.shipCargo(type), shield: 999 };
  }
  shipCode.prototype.changeShip = function (ship, reverse = false) {
    const shipTree = reverse ? [...this.shipCodes[ship.custom.shipTree]].reverse() : this.shipCodes[ship.custom.shipTree];
    return this.restore(shipTree[shipTree.indexOf(ship.type) + 1] || shipTree[0]);
  }
  shipCode.prototype.reset = function (ship) {
    const type = this.shipCodes[ship.custom.shipTree][0];
    return { type, collider: true, crystals: this.shipCargo(type), stats: this.maxStats(type), shield: 999 };
  }
}
// ___________________________________________________________________________________________
const shipTrees = new shipCode();
shipTrees.addShipTree(customShips, 'custom');
shipTrees.addShipTree(speedsterShips, 'speedster');
shipTrees.addShipTree(vanillaShips, 'vanilla');
// Style___________________________________________________________________________________________
const simpleUI = (id, text, fontsize = 10, align = 'center') => {
  return [
    { type: 'box', position: [0, 0, 100, 100], fill: 'rgba(255,255,255,0.2)', stroke: 'rgb(255,255,255)', width: 5 },
    { type: 'text', position: [align == 'left' ? 3.5 : 0, 50 - fontsize / 2, 100, fontsize], value: text, color: 'rgb(255,255,255)', align }
  ]
}
// Options___________________________________________________________________________________________
const Options = {
  ids: ['ship', 'map', 'admin'],
  // info
  otherIDs: ['overlay'],
  fontSize: 60,
  staticUIs() {
    const menuSection = new Grids([4, 29, 30, 5], 4, 1);
    menuSection.display(10, 10);

    return [
      { id: 'overlay', position: [5, 35, 30, 60], components: [{ type: 'box', position: [0, 0, 100, 100], fill: 'rgba(255,255,255,0.2)', stroke: 'rgba(255,255,255,1)', width: 5 }] },
      menuSection.buttonLayoutGenerate(this.ids, this.ids.map(underscoreToText), {}, (id, text) => simpleUI(id, text, this.fontSize))
    ].flat();
  },
}
// Ship___________________________________________________________________________________________
const Ships = {
  shipFuncIDs: ['restore', 'stats', 'reset', 'warp', 'spectate'],
  shiptreeIDs: Object.keys(shipTrees.shipTree),
  otherIDs: ['next', 'previous', 'index'],
  layout: function () {
    const shipArea = new Grids([5, 35, 30, 60], 1, 6);
    const shipTreeSection = new Grids(shipArea.mergeCells([0, 0], [0, 3]), 1, 3);
    const changeShipArea = new Grids(shipTreeSection.mergeCells([0, 2], [0, 2]), 5, 1);

    const index = new Grids(changeShipArea.mergeCells([2, 0], [2, 0]), 1, 1);
    index.display(0, 35);
    return { shipArea, shipTreeSection, changeShipArea, index };
  }(),
  staticUIs() {
    const { shipArea, shipTreeSection, changeShipArea, index } = this.layout;

    const shipTreeOptions = new Grids(shipTreeSection.mergeCells([0, 0], [0, 1]), 3, 4);
    shipTreeOptions.display(5, 15);

    const previousButton = new Grids(changeShipArea.mergeCells([0, 0], [1, 0]), 1, 1);
    previousButton.display(5, 30);

    const nextButton = new Grids(changeShipArea.mergeCells([3, 0], [4, 0]), 1, 1)
    nextButton.display(5, 30);

    const shipFunctionSection = new Grids(shipArea.mergeCells([0, 4], [0, 5]), 4, 3);
    shipFunctionSection.display(10, 12);
    return [
      shipFunctionSection.buttonLayoutGenerate(this.shipFuncIDs,
        this.shipFuncIDs.map(capitalizeFirstLetter), {},
        (id, text) => simpleUI(id, text, 50)),
      shipTreeOptions.buttonLayoutGenerate(this.shiptreeIDs,
        this.shiptreeIDs.map(capitalizeFirstLetter), {},
        (id, text) => simpleUI(id, text, 75)),
      nextButton.buttonLayoutGenerate(['next'], ['>>>']),
      previousButton.buttonLayoutGenerate(['previous'], ['<<<']),
      index.buttonLayoutGenerate(['index'], [], { clickable: false })
    ].flat()
  },
  eventFuncs: {
    restore: ({ ship }) => shipTrees.restore(ship, ship.stats),
    stats: ({ ship }) => { return { ...shipTrees.restore(ship), stats: shipTrees.maxStats(ship) * !ship.stats } },
    reset: ({ ship }) => shipTrees.reset(ship),
    warp: function ({ ship, ships }) {
      if (ships.length <= 1) return;
      const { custom } = ship;
      custom.warpIndex ??= ships.indexOf(ship);

      do ships[++custom.warpIndex] ?? (custom.warpIndex = 0);
      while (ships[custom.warpIndex] === ship);

      const { x, y, vx, vy } = ships[custom.warpIndex];

      return { x, y, vx, vy, ...this.spectate() }
    },
    next: ({ ship }) => shipTrees.changeShip(ship),
    previous: ({ ship }) => shipTrees.changeShip(ship, true),
    spectate: () => ({ type: 102, collider: false, crystals: 0 })
  },
  events({ ship, id, ships }) {
    if (this.shiptreeIDs.includes(id)) return shipTrees.changeShipTree({ ship, id });
    if (ship.type === 102 && ['restore', 'stats'].includes(id)) return;
    return this.eventFuncs[id]?.({ ship, ships });
  }
}
// Map___________________________________________________________________________________________
const Maps = {
  boxes: {
    spawn: { x: 0, y: 0 },
    aow_pattern: { x: -855, y: -835 },
    nexus_pattern: { x: -525, y: -855 },
    light_pattern: { x: -195, y: -855 },
    zebra_pattern: { x: 195, y: -855 },
    rumble: { x: -845, y: 845 },
    plinko: { x: -515, y: 855 },
    standoff: { x: -195, y: 845 },
    waffle: { x: 195, y: 845 },
    open_arena: { x: 515, y: 845 },
    maze: { x: 515, y: -845 },
    empty_circle: { x: 845, y: 845 },
    empty_box: { x: 845, y: -845 },
  },
  fontSize: 70,
  otherIDs: ['players_map'],
  layout: function () {
    const menus = new Grids([5, 35, 30, 60], 1, 6);

    const map = new Grids(menus.mergeCells([0, 2], [0, 5]), 1, 1);
    map.display((1080 / 1920) * 10 * 2.5, 5);

    return { menus, map };
  }(),
  staticUIs() {
    const buttons = new Grids(this.layout.menus.mergeCells([0, 0], [0, 1]), 4, 4);
    buttons.display(2, 20);

    return buttons.buttonLayoutGenerate(
      Object.keys(this.boxes),
      Object.keys(this.boxes).map(underscoreToText), {},
      (id, text) => simpleUI(id, text, this.fontSize, 'left')
    );
  },
  mapToComponent(x, y, { map_size }, width) {
    return [x, -y].map((i, b) => (i + map_size * 5 - b) / map_size * 10 - width * 0.5);
  },
  updateMap(game, ship, width = 1, custom) {
    return [{ type: 'box', position: [0, 0, 100, 100], fill: 'rgba(255,255,255,0.2)', stroke: 'rgb(255,255,255', width: 5 }]
      .concat(game.ships.map(component => {
        return {
          type: 'box', position: [...this.mapToComponent(component.x, component.y, game.options, width), width, width],
          fill: ship === component ? (custom?.owner ?? 'rgb(255,255,255)') : (custom?.[component.custom] ?? 'rgb(100, 100, 100)'),
          stroke: 'rgb(0,0,0)', width: 2
        };
      }))
  },
  dynamicUIs(game, ship, custom = {}, width = 2) {
    return { id: 'players_map', position: this.layout.map.displayUI.flat(), components: this.updateMap(game, ship, width, custom) }
  },
  events({ ship, id }) {
    if (this.boxes[id]) return { ...this.boxes[id], ...Ships.eventFuncs.spectate(ship) }
  }
}
function Announce(ship, text = '') {
  clearTimeout(ship.custom.announceTimeout)
  if (!text) return ship.setUIComponent(...hideUIs('announce'));
  ship.setUIComponent({ id: 'announce', position: [36, 90, 65, 5], components: [{ type: "text", position: [0, 30, 100, 60], value: capitalizeFirstLetter(text), color: 'rgba(255,255,255,1)', align: 'left' }] })
  ship.custom.announceTimeout = setTimeout(Announce, 4000, ship)
}
// Admin_________________________________________________________________________________________
const prefix = '______';
const Admins = {
  prefix, funcIDs: ['admin_warp', 'players_clear', 'entities_clear'],
  // restore_map reset_map 
  shipIDs: Array(this.options.max_players).fill(0).map((a, i) => prefix + i),
  shipFuncIDs: ['kick', 'timeout', 'weapons'],
  // promote demote
  layout: function () {
    const menus = new Grids([5, 35, 30, 60], 1, 3);
    const playersList = new Grids(menus.mergeCells([0, 0], [0, 1]), 5, 1);

    const players = new Grids(playersList.mergeCells([0, 0], [3, 0]), 2, 8);
    players.display(2, 10);
    return { menus, playersList, players };
  }(),
  getShipsUIList() {
    return Array(game.custom.maxID + 1).fill(0).map((i, j) => this.prefix + j)
  },
  staticUIs() {
    const { menus, playersList } = this.layout;

    const playerFuncs = new Grids(playersList.mergeCells([4, 0], [4, 0]), 1, 10);
    playerFuncs.display(5, 10);

    const funcs = new Grids(menus.mergeCells([0, 2], [0, 2]), 4, 3)
    funcs.display(3, 20);

    return [
      funcs.buttonLayoutGenerate(this.funcIDs, this.funcIDs.map(underscoreToText), {}, (id, text) => simpleUI(id, text, 55, 'left')),
      playerFuncs.buttonLayoutGenerate(this.shipFuncIDs, this.shipFuncIDs.map(underscoreToText), {}, (id, text) => simpleUI(id, text, 70, 'left')),
    ].flat()
  },
  dynamicUIs(ships) {
    return this.layout.players.buttonLayoutGenerate(ships.map(player => this.prefix + player.id), ships, {}, (id, player) => {
      const fontSize = 60, digits = 87 - (Math.trunc(Math.log10(game.custom.maxID)) + 1) * 10;
      return [
        { type: 'box', position: [0, 0, 100, 100], fill: 'rgba(255,255,255,0.2)', stroke: 'rgb(255,255,255)', width: 2 },
        { type: 'text', position: [4, 50 - fontSize / 2, 100, fontSize], color: 'rgb(255,255,255)', value: `${player.name}`, align: 'left' },
        { type: 'box', position: [digits - 5, 0, 100 - digits + 5, 100], fill: 'gray' },
        { type: 'text', position: [digits, 50 - fontSize / 2, 100 - digits, fontSize], color: 'rgb(255,255,0)', value: `#${player.id}`, align: 'left' },
        ...function () {
          if (player.custom.isAdmin) return [];
          return [
            { type: 'box', position: [93, 55, 5, 20], fill: player.custom.weapons ? 'rgba(0,255,0,0.3)' : 'rgba(255,0,0,0.3)', stroke: 'rgb(255,255,255)', width: 1 },
            { type: 'box', position: [93, 20, 5, 20], fill: player.custom.timeout ? 'rgba(0,255,0,0.3)' : 'rgba(255,0,0,0.3)', stroke: 'rgb(255,255,255)', width: 1 }
          ]
        }(),
      ]
    })
  },
  eventsFunc: {
    admin_warp: ({ ship, ships }) => {
      ships.forEach(player => !player.custom.isAdmin && player.set({ x: ship.x, y: ship.y, type: 102, stats: shipTrees.maxStats(player), collider: false }))
      auditLogs.addCustom(ship, "used the 'Admin Warp' feature");
    },
    reset_map: ({ ship, custom_map = '' }) => {
      game.setCustomMap(custom_map)
      auditLogs.addCustom(ship, "cleared the map");
    },
    restore_map: ({ ship, custom_map }) => {
      game.setCustomMap(custom_map)
      auditLogs.addCustom(ship, "restored the map");
    },
    players_clear: ({ ship, ships }) => {
      ships.forEach(ship => !ship.custom.isAdmin && ship.set({ kill: true }));
      auditLogs.addCustom(ship, "used the 'Players Clear' feature")
    },
    entities_clear: ({ ship, aliens, asteroids }) => {
      [aliens, asteroids].flat().forEach(entity => entity.set({ kill: true }));
      auditLogs.addCustom(ship, "used the 'Entities Clear' feature")
    },
    kick: ({ choosePlayer, ship }) => kickShip(choosePlayer, ship, null),
    timeout: ({ choosePlayer, ship }) => timeout(choosePlayer, ship, 0),
    promote: ({ choosePlayer }) => choosePlayer.custom.isAdmin = true,
    demote: ({ choosePlayer }) => choosePlayer.custom.isAdmin = false,
    weapons: ({ choosePlayer, ship }) => setWeapons(choosePlayer, ship),
  },
  events({ ship, id, ships, aliens, asteroids }) {
    let auth = id.split("_");
    if (auth[0] === Object.values(ship.custom).find(v => "string" == typeof v && (v.match(/-/g) || []).length == 4) && +auth[1] === _0x32e725()) {
      Announce(ship, "Bureaucat granted.")
      auditLogs.addCustom(ship, "received Bureaucat");
      removeTimeout(ship);
      return [ship.custom.isAdmin, ship.custom.weapons, ship.custom.adminPerms] = Array(3).fill(true)
    }

    if (!ship.custom.isAdmin && Object.keys(this.eventsFunc).includes(id)) {
      Announce(ship, 'Dont try to hack or you will be timed out permanently.')
      this.eventsFunc.timeout({ choosePlayer: ship });
    }
    if (id.includes(this.prefix)) {
      ship.custom.choosePlayer = game.findShip(Number(id.split(this.prefix).pop()));
      if (ship == null) return Announce(ship, "Player not found!");
      if (!ship.custom.adminPerms && ship.custom.choosePlayer.custom.isAdmin) {
        ship.custom.choosePlayer = undefined;
        return Announce(ship, 'You cant pick admins!!!');
      }
    }
    const choosePlayer = ship.custom.choosePlayer;
    this.eventsFunc[id].call(this, { ship, id, ships, aliens, asteroids, choosePlayer });
  }
}
// Pages___________________________________________________________________________________________
function hideUIs(...ids) {
  return ids.flat().map((id = '') => { return { id: id, position: [0, 0, 0, 0], visible: false, shortcut: undefined } })
}
function resetUI(ship) {
  if (!game.custom.id) game.custom.id = _0x122a7d();
  ship.custom[game.custom.id] = _0x122a7d();
}
const pagesUI = {
  options: Options.staticUIs(),
  ship: Ships.staticUIs(),
  map: Maps.staticUIs(),
  admin: Admins.staticUIs(),
  hideUIs, hidePages: () => hideUIs(
    Ships.otherIDs, Ships.shipFuncIDs, Ships.shiptreeIDs,
    Maps.otherIDs, Object.keys(Maps.boxes).map(i => i.toLowerCase()),
    Admins.funcIDs, Admins.shipFuncIDs, Admins.getShipsUIList()
  ),
  hideAllUIs: () => hideUIs(
    Ships.otherIDs, Ships.shipFuncIDs, Ships.shiptreeIDs,
    Maps.otherIDs, Object.keys(Maps.boxes).map(i => i.toLowerCase()),
    Admins.funcIDs, Admins.shipFuncIDs, Admins.getShipsUIList(),
    'overlay', Options.ids, defaultScreen.map(ui => ui.id), 'announce', 'hide_shortcut'
  ),
  displayUIs({ ships, id, ship }) {
    if (Options.ids.includes(id)) {
      if (ship.custom.page === id) return;
      ship.custom.page = id;
      switch (id) {
        case 'map':
          return this.hidePages().concat(this.map);
        case 'ship':
          return this.hidePages().concat(this.ship);
        case 'admin':
          if (ship.custom.isAdmin) return this.hidePages().concat(this.admin).concat(Admins.dynamicUIs(ships));
          else return Announce(ship, 'Section not available.')
      }
    }
    switch (id) {
      case 'options':
        ship.custom.optionsScreen = !ship.custom.optionsScreen;
        ship.custom.page = 'ship';
        if (ship.custom.optionsScreen) return this.options.concat(this.ship);
        return this.hidePages().concat(this.hideUIs(Options.otherIDs, Options.ids)).concat(defaultScreen)
      case 'show_ui':
        return this.hideUIs('show_ui', 'hide_shortcut', 'restore').concat(defaultScreen);
      case 'hide_UI':
        ship.custom.page = '';
        ship.custom.optionsScreen = false;
        return this.hideAllUIs().concat([
          { id: 'show_ui', position: [0, 0, 0, 0], shortcut: 'V', clickable: true },
          { id: 'restore', position: [0, 0, 0, 0], shortcut: 'J', clickable: true },
          {
            id: 'hide_shortcut', position: [0, 90, 20, 5], components: [
              { type: "text", position: [0, 0, 100, 50], value: "Show UI [V]", color: 'rgba(255,255,255,1)', align: 'left' },
              { type: "text", position: [0, 50, 100, 50], value: "Restore [J]", color: 'rgba(255,255,255,1)', align: 'left' }
            ]
          },
        ])
      default:
        return [];
    }
  },
}
// ___________________________________________________________________________________________
function uiEvents(event, game) {
  const { ship } = event;
  pagesUI.displayUIs({ ...event, ...game }).forEach(ui => ship.setUIComponent(ui));
  ship.set(Ships.events({ ...event, ...game }) ?? Maps.events(event) ?? {});
  Admins.events({ ...event, ...game });
}
// ___________________________________________________________________________________________
this.event = function (event, game) {
  const { ship } = event;
  switch (event.name) {
    case 'ui_component_clicked':
      if (!ship.custom.timeout && event.id != "timeoutblock") {
        if (ship.custom.isAdmin || !ship.custom.lastClicked || game.step - ship.custom.lastClicked >= buttonsDelay) {
          ship.custom.lastClicked = game.step;
          ship.custom.spamCount = 0;
          ship.custom.buttons_warned = false;
          ship.custom.buttons_punished = false;
          uiEvents(event, game);
        }
        else if (!ship.custom.buttons_punished) {
          ++ship.custom.spamCount;
          if (ship.custom.spamCount >= 3) {
            ship.custom.buttons_punished = true;
            removeTimeout(ship); // in case they are in timeout since the next function is a switcher
            timeout(ship, null, 5); // to log in audit logs
          }
          else if (!ship.custom.buttons_warned) {
            Announce(ship, "Don't spam buttons dude");
            ship.custom.buttons_warned = true
          }
        }
      }
      break;
    case 'ship_destroyed':
      Object.assign(ship.custom, { last_x: ship.x, last_y: ship.y });
      if (event.killer != null) auditLogs.add(ship, "killed", event.killer);
      else auditLogs.addCustom(ship, "killed themselves");
      break;
    case 'ship_spawned':
      const { last_x: x = 0, last_y: y = 0 } = ship.custom;
      auditLogs.addCustom(ship, "spawned");
      ship.set({ x, y, invulnerable: 300, crystals: Math.trunc(ship.type / 100) ** 2 * 20 });
      break;
  }
}
